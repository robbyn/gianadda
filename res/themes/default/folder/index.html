<!DOCTYPE html>
#set( $thumbSize = $conf.dims['thumb-size'] )
#set( $previewSize = $conf.dims['preview-size'] )
#set( $subfolders = $folder.subfolders )
#set( $pictures = $folder.pictures )
<html class="index">
    <head>
        <title>$esc.html($folder.title)</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="${base}css/normalize.css">
        <link rel="stylesheet" href="${base}css/style.css">
    </head>
    <body>
        <h1>$esc.html($folder.title)</h1>
        <div>
            #if( !$subfolders.empty )
            <nav class="folders">
                <ul>
                #foreach( $sub in $subfolders )
                <li id="fld$sub.id"><a href="$esc.url($sub.name)/index.html">$esc.html($sub.title)</a></li>
                #end
                </ul>
            </nav>
            #end
            #if( !$pictures.empty )
            <nav class="thumbs">
                #foreach( $pic in $pictures )
                <figure id="pic$pic.id">
                    <a href="preview/${esc.url($pic.name)}.html"><img src="thumb/$esc.url($pic.name)" height="$math.round($thumbSize.height)" title="$esc.html($pic.name)"></a>
                    <figcaption>$esc.html($pic.name)</figcaption>
                </figure>
                #end
            </nav>
            #end
            #set( $geopics = [] )
            #foreach( $pic in $pictures )
                #if( $pic.gpsData )
                    #set( $dummy = $geopics.add($pic) )
                #end
            #end
            #if( not $geopics.empty )
            <div class="map" id="map"></div>
            #end
        </div>
        #if( not $geopics.empty )
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&language=fr"></script>
        <script type="text/javascript">
            window.onload = function() {
                var markers = [
                #foreach( $pic in $geopics )
                    {
                        position: new google.maps.LatLng($pic.gpsData.latitude,$pic.gpsData.longitude),
                        info: new google.maps.InfoWindow({
                            content: '<a href="preview/${esc.url($pic.name)}.html"><img src="thumb/$esc.url($pic.name)" height="$math.round($thumbSize.height)" title="$esc.html($pic.name)"></a>',
                        }),
                    },
                #end
                ];
                var bounds = new google.maps.LatLngBounds(markers[0].position);
                for (var i = 1; i < markers.length; ++i) {
                    bounds.extend(markers[i].position);
                }
                var mapOptions = {
                    zoom: 8,
                    center: bounds.getCenter(),
                    mapTypeId: google.maps.MapTypeId.TERRAIN
                };
                var map = new google.maps.Map(document.getElementById("map"),
                        mapOptions);
                for (i = 0; i < markers.length; ++i) {
                    marker = new google.maps.Marker(markers[i]);
                    marker.setMap(map);
                    google.maps.event.addListener(marker, 'click', function() {
                        this.info.open(map, this);
                    });
                }
                map.fitBounds(bounds);
            }
        </script>
        #end
    </body>
</html>

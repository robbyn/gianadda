<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapping PUBLIC '-//tastefuljava.org//Jedo Mapping File 1.0//EN' 'jedo.dtd'>
<mapping package="org.tastefuljava.gianadda.domain">
    <class name="Folder">
        <id>
            <property name="id" column="ID"/>
        </id>
        <reference name="parent" column="PARENT_ID"/>
        <property name="name" column="NAME"/>
        <property name="title" column="TITLE"/>
        <property name="description" column="DESCRIPTION"/>
        <collection name="folders" query="subfolders" fetch-mode="lazy"/>
        <collection name="pictures" query="inFolder" fetch-mode="lazy"/>
        <collection name="tracks" query="inFolder" fetch-mode="lazy"/>

        <load>
            SELECT * FROM folders
            WHERE ID=${id}
        </load>
        <query name="root" parameters="name">
            SELECT * FROM folders
            WHERE PARENT_ID IS NULL AND NAME=${name}
        </query>
        <query name="subfolder" parameters="parent,name">
            SELECT * FROM folders
            WHERE PARENT_ID=${parent.id} AND NAME=${name}
        </query>
        <query name="subfolders" parameters="parentId">
            SELECT * FROM folders
            WHERE PARENT_ID=${parentId}
        </query>
        <insert get-generated-keys="true">
            INSERT INTO folders(PARENT_ID,NAME,TITLE,DESCRIPTION)
            VALUES(${parent.id},${name},${title},${description});
        </insert>
        <update>
            UPDATE folders
            SET PARENT_ID=${parent.id},NAME=${name},TITLE=${title},
                DESCRIPTION=${description},
            WHERE ID=${id}
        </update>
        <delete>
            DELETE FROM folders WHERE ID=${id}
        </delete>
    </class>

    <class name="Picture">
        <id>
            <property name="id" column="ID"/>
        </id>
        <reference name="folder" column="FOLDER_ID"/>
        <property name="name" column="NAME"/>
        <property name="dateTime" column="DATETIME"/>
        <property name="width" column="WIDTH"/>
        <property name="height" column="HEIGHT"/>
        <property name="description" column="DESCRIPTION"/>
        <property name="artist" column="ARTIST"/>
        <property name="copyright" column="COPYRIGHT"/>
        <component name="gpsData">
            <property name="latitude" column="LATITUDE"/>
            <property name="longitude" column="LONGITUDE"/>
            <property name="altitude" column="ALTITUDE"/>
        </component>

        <load>
            SELECT * FROM pictures
            WHERE ID=${id}
        </load>
        <query name="byName" parameters="folder,name">
            SELECT * FROM pictures
            WHERE FOLDER_ID=${folder.id} AND NAME=${name}
        </query>
        <query name="inFolder" parameters="folderId">
            SELECT * FROM pictures
            WHERE FOLDER_ID=${folderId}
        </query>
        <insert get-generated-keys="true">
            INSERT INTO pictures(FOLDER_ID,NAME,DATETIME,WIDTH,HEIGHT,LATITUDE,
                LONGITUDE,ALTITUDE,DESCRIPTION,ARTIST,COPYRIGHT)
            VALUES(${folder.id},${name},${dateTime},${width},${height},
                ${gpsData.latitude},${gpsData.longitude},${gpsData.altitude},
                ${description},${artist},${copyright});
        </insert>
        <update>
            UPDATE pictures
            SET FOLDER_ID=${folder.id},NAME=${name},DATETIME=${dateTime},
                WIDTH=${width},HEIGHT=${height},LATITUDE=${gpsData.latitude},
                LONGITUDE=${gpsData.longitude},ALTITUDE=${gpsData.altitude},
                DESCRIPTION=${description},ARTIST=${artist},
                COPYRIGHT=${copyright}
            WHERE ID=${id}
        </update>
        <delete>
            DELETE FROM pictures WHERE ID=${id}
        </delete>
    </class>

    <class name="Track">
        <id>
            <property name="id" column="ID"/>
        </id>
        <reference name="folder" column="FOLDER_ID"/>
        <property name="name" column="NAME"/>
        <property name="dateTime" column="DATETIME"/>
        <component name="bounds">
            <property name="south" column="SOUTH"/>
            <property name="west" column="WEST"/>
            <property name="north" column="NORTH"/>
            <property name="east" column="EAST"/>
        </component>
        <property name="gpx" column="GPX"/>

        <load>
            SELECT * FROM tracks
            WHERE ID=${id}
        </load>
        <query name="byName" parameters="folder,name">
            SELECT * FROM tracks
            WHERE FOLDER_ID=${folder.id} AND NAME=${name}
        </query>
        <query name="inFolder" parameters="folderId">
            SELECT * FROM tracks
            WHERE FOLDER_ID=${folderId}
        </query>
        <insert get-generated-keys="true">
            INSERT INTO tracks(FOLDER_ID,NAME,DATETIME,SOUTH,WEST,NORTH,EAST,
            GPX) VALUES(${folder.id},${name},${dateTime},${bounds.south},
                ${bounds.west},${bounds.north},${bounds.east},${gpx});
        </insert>
        <update>
            UPDATE tracks
            SET FOLDER_ID=${folder.id},NAME=${name},DATETIME=${dateTime},
                SOUTH=${bounds.south},WEST=${bounds.west},NORTH=${bounds.north},
                EAST=${bounds.east},GPX=${gpx}
            WHERE ID=${id}
        </update>
        <delete>
            DELETE FROM tracks WHERE ID=${id}
        </delete>
    </class>

    <class name="Tag">
        <id>
            <property name="id" column="ID"/>
        </id>
        <property name="tag" column="TAG"/>

        <load>
            SELECT * FROM tags
            WHERE ID=${id}
        </load>
        <query name="byTag" parameters="tag">
            SELECT * FROM tracks
            WHERE TAG=${tag}
        </query>
        <insert get-generated-keys="true">
            INSERT INTO tags(TAG)
            VALUES(${tag})
        </insert>
        <update>
            UPDATE tracks
            SET TAG=${tag}
            WHERE ID=${id}
        </update>
        <delete>
            DELETE FROM tags WHERE ID=${id}
        </delete>
    </class>
</mapping>

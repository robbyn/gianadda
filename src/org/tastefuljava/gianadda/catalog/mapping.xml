<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapping PUBLIC '-//tastefuljava.org//Jedo Mapping File 1.0//EN' 'jedo.dtd'>
<mapping package="org.tastefuljava.gianadda.domain">
    <class name="Folder">
        <id>
            <property name="id" column="ID"/>
        </id>
        <reference name="parent" column="PARENT_ID" fetch-mode="eager"/>
        <property name="name" column="NAME"/>
        <property name="title" column="TITLE"/>
        <property name="description" column="DESCRIPTION"/>
        <collection name="folders" column="ID" query="subfolders"
                fetch-mode="lazy"/>
        <collection name="pictures" column="ID" query="inFolder"
                fetch-mode="lazy"/>

        <load>
            SELECT * FROM folders
            WHERE ID=${id}
        </load>
        <query name="root" parameters="name">
            SELECT * FROM folders
            WHERE PARENT_ID IS NULL AND NAME=${name}
        </query>
        <query name="subfolder" parameters="parent,name">
            SELECT * FROM folders
            WHERE PARENT_ID=${parent.id} AND NAME=${name}
        </query>
        <query name="subfolders" parameters="parentId">
            SELECT * FROM folders
            WHERE PARENT_ID=${parentId}
        </query>
        <insert get-generated-keys="true">
            INSERT INTO folders(PARENT_ID,NAME,TITLE,DESCRIPTION)
            VALUES(${parent.id},${name},${title},${description});
        </insert>
        <update>
            UPDATE folders
            SET PARENT_ID=${parent.id},NAME=${name},TITLE=${title},
                DESCRIPTION=${description},
            WHERE ID=${id}
        </update>
        <delete>
            DELETE FROM folders WHERE ID=${id}
        </delete>
    </class>

    <class name="Picture">
        <id>
            <property name="id" column="ID"/>
        </id>
        <reference name="folder" column="FOLDER_ID" fetch-mode="lazy"/>
        <property name="name" column="NAME"/>
        <property name="dateTime" column="DATETIME"/>
        <property name="width" column="WIDTH"/>
        <property name="height" column="HEIGHT"/>
        <property name="description" column="DESCRIPTION"/>
        <property name="artist" column="ARTIST"/>
        <property name="copyright" column="COPYRIGHT"/>
        <component name="gpsData">
            <property name="latitude" column="LATITUDE"/>
            <property name="longitude" column="LONGITUDE"/>
            <property name="altitude" column="ALTITUDE"/>
        </component>

        <load>
            SELECT * FROM pictures
            WHERE ID=${id}
        </load>
        <query name="byName" parameters="folder,name">
            SELECT * FROM pictures
            WHERE FOLDER_ID=${folder.id} AND NAME=${name}
        </query>
        <query name="inFolder" parameters="folderId">
            SELECT * FROM pictures
            WHERE FOLDER_ID=${folderId}
        </query>
        <insert get-generated-keys="true">
            INSERT INTO pictures(FOLDER_ID,NAME,DATETIME,WIDTH,HEIGHT,LATITUDE,
                LONGITUDE,ALTITUDE,DESCRIPTION,ARTIST,COPYRIGHT)
            VALUES(${folder.id},${name},${dateTime},${width},${height},
                ${gpsData.latitude},${gpsData.longitude},${gpsData.altitude},
                ${description},${artist},${copyright});
        </insert>
        <update>
            UPDATE pictures
            SET FOLDER_ID=${folder.id},NAME=${name},DATETIME=${dateTime},
                WIDTH=${width},HEIGHT=${height},LATITUDE=${gpsData.latitude},
                LONGITUDE=${gpsData.longitude},ALTITUDE=${gpsData.altitude},
                DESCRIPTION=${description},ARTIST=${artist},
                COPYRIGHT=${copyright}
            WHERE ID=${id}
        </update>
        <delete>
            DELETE FROM pictures WHERE ID=${id}
        </delete>
    </class>
</mapping>
